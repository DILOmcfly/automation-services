<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>n8n Workflow Visualizer ‚Äî AuraHub</title>
<meta name="description" content="Free n8n workflow visualizer. Paste any workflow JSON to see a visual node diagram instantly.">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a0a;color:#e0e0e0;font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh}
.header{background:linear-gradient(135deg,#1a1a2e,#16213e);padding:20px 30px;border-bottom:1px solid #c8a86633;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
.header h1{font-size:1.4rem;color:#c8a866}
.header h1 span{color:#888;font-weight:400;font-size:.9rem}
.header nav a{color:#888;text-decoration:none;font-size:.85rem;margin-left:16px;transition:color .2s}
.header nav a:hover{color:#c8a866}
.main{display:grid;grid-template-columns:320px 1fr;gap:0;height:calc(100vh - 70px)}
.sidebar{background:#111;border-right:1px solid #222;padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:16px}
.sidebar label{font-size:.8rem;color:#888;text-transform:uppercase;letter-spacing:.5px}
.sidebar textarea{width:100%;height:200px;background:#0a0a0a;border:1px solid #333;border-radius:8px;color:#e0e0e0;font-family:'Courier New',monospace;font-size:.78rem;padding:10px;resize:vertical;transition:border-color .2s}
.sidebar textarea:focus{outline:none;border-color:#c8a866}
.btn-row{display:flex;gap:8px;flex-wrap:wrap}
.btn{padding:8px 14px;border:none;border-radius:6px;cursor:pointer;font-size:.8rem;font-weight:600;transition:all .2s}
.btn-gold{background:#c8a866;color:#0a0a0a}.btn-gold:hover{background:#d4b876}
.btn-outline{background:transparent;border:1px solid #444;color:#ccc}.btn-outline:hover{border-color:#c8a866;color:#c8a866}
.stats{background:#1a1a2e;border-radius:10px;padding:14px;display:grid;grid-template-columns:1fr 1fr;gap:8px}
.stat{text-align:center;padding:8px;background:#0a0a0a;border-radius:6px}
.stat .val{font-size:1.3rem;font-weight:700;color:#c8a866}
.stat .lbl{font-size:.7rem;color:#888;margin-top:2px}
.canvas-wrap{position:relative;overflow:hidden;background:#0a0a0a}
svg{width:100%;height:100%}
.node-card{cursor:pointer;transition:filter .2s}
.node-card:hover{filter:brightness(1.2)}
.empty-state{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#555}
.empty-state p{font-size:1.1rem;margin-bottom:10px}
.empty-state span{font-size:.85rem;color:#666}
.toast{position:fixed;bottom:20px;right:20px;background:#1a1a2e;border:1px solid #c8a866;color:#e0e0e0;padding:12px 20px;border-radius:8px;font-size:.85rem;opacity:0;transition:opacity .3s;pointer-events:none;z-index:99}
.toast.show{opacity:1}
@media(max-width:768px){.main{grid-template-columns:1fr;grid-template-rows:auto 1fr}.sidebar{max-height:40vh}}
</style>
</head>
<body>
<div class="header">
  <h1>‚ö° n8n Workflow Visualizer <span>by AuraHub</span></h1>
  <nav>
    <a href="index.html">Services</a>
    <a href="templates.html">Templates</a>
    <a href="validator.html">Validator</a>
    <a href="calculator.html">ROI Calc</a>
  </nav>
</div>
<div class="main">
  <div class="sidebar">
    <div>
      <label>Paste n8n Workflow JSON</label>
      <textarea id="jsonInput" placeholder='{"nodes":[...],"connections":{...}}'></textarea>
    </div>
    <div class="btn-row">
      <button class="btn btn-gold" onclick="visualize()">Visualize</button>
      <button class="btn btn-outline" onclick="loadSample()">Load Sample</button>
      <button class="btn btn-outline" onclick="exportPNG()">Export PNG</button>
      <button class="btn btn-outline" onclick="clearAll()">Clear</button>
    </div>
    <div>
      <label>Workflow Stats</label>
      <div class="stats">
        <div class="stat"><div class="val" id="sNodes">‚Äî</div><div class="lbl">Nodes</div></div>
        <div class="stat"><div class="val" id="sConns">‚Äî</div><div class="lbl">Connections</div></div>
        <div class="stat"><div class="val" id="sTriggers">‚Äî</div><div class="lbl">Triggers</div></div>
        <div class="stat"><div class="val" id="sErrors">‚Äî</div><div class="lbl">Error Handling</div></div>
      </div>
    </div>
    <div style="margin-top:auto;padding-top:16px;border-top:1px solid #222">
      <p style="font-size:.75rem;color:#666">Free tool by <a href="index.html" style="color:#c8a866;text-decoration:none">AuraHub Automation Services</a>. Need custom workflows? <a href="index.html#contact" style="color:#c8a866;text-decoration:none">Contact us</a>.</p>
    </div>
  </div>
  <div class="canvas-wrap" id="canvasWrap">
    <div class="empty-state" id="emptyState">
      <p>üìã Paste a workflow JSON or click <strong>Load Sample</strong></p>
      <span>Supports any n8n workflow export format</span>
    </div>
    <svg id="svg" xmlns="http://www.w3.org/2000/svg"></svg>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
const COLORS={trigger:'#22c55e',action:'#3b82f6',logic:'#a855f7',error:'#ef4444',default:'#c8a866'};
const CARD_W=180,CARD_H=60,GAP_X=80,GAP_Y=30,PAD=60;

function nodeColor(type){
  const t=(type||'').toLowerCase();
  if(t.includes('webhook')||t.includes('trigger')||t.includes('cron')||t.includes('schedule'))return COLORS.trigger;
  if(t.includes('if')||t.includes('switch')||t.includes('merge')||t.includes('filter'))return COLORS.logic;
  if(t.includes('error')||t.includes('stop'))return COLORS.error;
  if(t.includes('set')||t.includes('code')||t.includes('function'))return COLORS.action;
  return COLORS.default;
}
function isTrigger(type){const t=(type||'').toLowerCase();return t.includes('trigger')||t.includes('webhook')||t.includes('cron')||t.includes('schedule')}
function shortName(name,type){return name||type.replace(/^n8n-nodes-base\./,'').replace(/([A-Z])/g,' $1').trim()}

function parseWorkflow(json){
  let wf;
  try{wf=JSON.parse(json)}catch(e){throw new Error('Invalid JSON: '+e.message)}
  const nodes=(wf.nodes||[]).map(n=>({id:n.id||n.name,name:n.name,type:n.type||'',position:n.position||[0,0]}));
  const edges=[];
  const conns=wf.connections||{};
  for(const src of Object.keys(conns)){
    const outputs=conns[src];
    if(!outputs)continue;
    // outputs can be {main:[[{node,type,index}]]} or just [[{node}]]
    const groups=outputs.main||outputs;
    if(!Array.isArray(groups))continue;
    for(const group of groups){
      if(!Array.isArray(group))continue;
      for(const link of group){
        if(link&&link.node)edges.push({from:src,to:link.node});
      }
    }
  }
  return{nodes,edges};
}

function layout(nodes,edges){
  // Build adjacency
  const adj={},inDeg={};
  nodes.forEach(n=>{adj[n.name]=[];inDeg[n.name]=0});
  edges.forEach(e=>{
    if(adj[e.from])adj[e.from].push(e.to);
    if(inDeg[e.to]!==undefined)inDeg[e.to]++;
  });
  // Topological layers
  const layers=[];
  const visited=new Set();
  let queue=nodes.filter(n=>inDeg[n.name]===0).map(n=>n.name);
  if(queue.length===0)queue=[nodes[0]?.name].filter(Boolean);
  while(queue.length>0){
    layers.push([...queue]);
    queue.forEach(n=>visited.add(n));
    const next=[];
    for(const n of queue){
      for(const nb of(adj[n]||[])){
        inDeg[nb]--;
        if(inDeg[nb]<=0&&!visited.has(nb)&&!next.includes(nb))next.push(nb);
      }
    }
    queue=next;
  }
  // Place unvisited
  nodes.forEach(n=>{if(!visited.has(n.name)){layers.push([n.name]);visited.add(n.name)}});
  // Assign positions
  const pos={};
  layers.forEach((layer,col)=>{
    const totalH=layer.length*(CARD_H+GAP_Y)-GAP_Y;
    const startY=Math.max(PAD,(400-totalH)/2);
    layer.forEach((name,row)=>{
      pos[name]={x:PAD+col*(CARD_W+GAP_X),y:startY+row*(CARD_H+GAP_Y)};
    });
  });
  return{pos,layers};
}

function render(nodes,edges,pos){
  const svg=document.getElementById('svg');
  const wrap=document.getElementById('canvasWrap');
  document.getElementById('emptyState').style.display='none';
  // Calculate bounds
  let maxX=0,maxY=0;
  Object.values(pos).forEach(p=>{maxX=Math.max(maxX,p.x+CARD_W+PAD);maxY=Math.max(maxY,p.y+CARD_H+PAD)});
  const w=Math.max(maxX,wrap.clientWidth);
  const h=Math.max(maxY,wrap.clientHeight);
  svg.setAttribute('viewBox',`0 0 ${w} ${h}`);
  svg.innerHTML='';
  // Defs
  const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');
  defs.innerHTML=`<marker id="arrow" viewBox="0 0 10 8" refX="10" refY="4" markerWidth="8" markerHeight="6" orient="auto-start-reverse"><path d="M0,0 L10,4 L0,8 Z" fill="#555"/></marker>
  <filter id="glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>`;
  svg.appendChild(defs);
  // Draw edges
  const nodeMap={};
  nodes.forEach(n=>nodeMap[n.name]=n);
  edges.forEach(e=>{
    const from=pos[e.from],to=pos[e.to];
    if(!from||!to)return;
    const x1=from.x+CARD_W,y1=from.y+CARD_H/2;
    const x2=to.x,y2=to.y+CARD_H/2;
    const cx1=x1+(x2-x1)*0.5,cx2=x2-(x2-x1)*0.5;
    const path=document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d',`M${x1},${y1} C${cx1},${y1} ${cx2},${y2} ${x2},${y2}`);
    path.setAttribute('fill','none');
    path.setAttribute('stroke','#444');
    path.setAttribute('stroke-width','2');
    path.setAttribute('marker-end','url(#arrow)');
    svg.appendChild(path);
  });
  // Draw nodes
  nodes.forEach(n=>{
    const p=pos[n.name];if(!p)return;
    const g=document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('class','node-card');
    g.setAttribute('transform',`translate(${p.x},${p.y})`);
    const color=nodeColor(n.type);
    // Card bg
    const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('width',CARD_W);rect.setAttribute('height',CARD_H);
    rect.setAttribute('rx','10');rect.setAttribute('fill','#1a1a2e');
    rect.setAttribute('stroke',color);rect.setAttribute('stroke-width','2');
    g.appendChild(rect);
    // Color bar
    const bar=document.createElementNS('http://www.w3.org/2000/svg','rect');
    bar.setAttribute('width','4');bar.setAttribute('height',CARD_H);
    bar.setAttribute('rx','2');bar.setAttribute('fill',color);
    g.appendChild(bar);
    // Icon circle
    const circle=document.createElementNS('http://www.w3.org/2000/svg','circle');
    circle.setAttribute('cx','24');circle.setAttribute('cy',CARD_H/2);
    circle.setAttribute('r','10');circle.setAttribute('fill',color+'33');
    circle.setAttribute('stroke',color);circle.setAttribute('stroke-width','1');
    g.appendChild(circle);
    // Icon text
    const icon=document.createElementNS('http://www.w3.org/2000/svg','text');
    icon.setAttribute('x','24');icon.setAttribute('y',CARD_H/2+4);
    icon.setAttribute('text-anchor','middle');icon.setAttribute('font-size','10');
    icon.setAttribute('fill',color);
    icon.textContent=isTrigger(n.type)?'‚ñ∂':n.type.toLowerCase().includes('if')?'‚óÜ':'‚óè';
    g.appendChild(icon);
    // Name
    const text=document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x','42');text.setAttribute('y',CARD_H/2-4);
    text.setAttribute('fill','#e0e0e0');text.setAttribute('font-size','11');
    text.setAttribute('font-weight','600');
    const label=shortName(n.name,n.type);
    text.textContent=label.length>16?label.slice(0,15)+'‚Ä¶':label;
    g.appendChild(text);
    // Type
    const sub=document.createElementNS('http://www.w3.org/2000/svg','text');
    sub.setAttribute('x','42');sub.setAttribute('y',CARD_H/2+12);
    sub.setAttribute('fill','#888');sub.setAttribute('font-size','9');
    const typeName=n.type.replace(/^n8n-nodes-base\./,'');
    sub.textContent=typeName.length>20?typeName.slice(0,19)+'‚Ä¶':typeName;
    g.appendChild(sub);
    svg.appendChild(g);
  });
}

function updateStats(nodes,edges){
  document.getElementById('sNodes').textContent=nodes.length;
  document.getElementById('sConns').textContent=edges.length;
  document.getElementById('sTriggers').textContent=nodes.filter(n=>isTrigger(n.type)).length;
  const hasError=nodes.some(n=>(n.type||'').toLowerCase().includes('error')||
    (n.name||'').toLowerCase().includes('error'));
  document.getElementById('sErrors').textContent=hasError?'‚úÖ Yes':'‚ùå No';
}

function visualize(){
  const json=document.getElementById('jsonInput').value.trim();
  if(!json){toast('Paste a workflow JSON first');return}
  try{
    const{nodes,edges}=parseWorkflow(json);
    if(nodes.length===0){toast('No nodes found in workflow');return}
    const{pos}=layout(nodes,edges);
    render(nodes,edges,pos);
    updateStats(nodes,edges);
    toast('‚úÖ Rendered '+nodes.length+' nodes');
  }catch(e){toast('‚ùå '+e.message)}
}

function loadSample(){
  const sample={
    "name":"Lead Processing Workflow",
    "nodes":[
      {"name":"Webhook","type":"n8n-nodes-base.webhook","position":[250,300]},
      {"name":"Validate Data","type":"n8n-nodes-base.if","position":[450,300]},
      {"name":"Enrich Lead","type":"n8n-nodes-base.set","position":[650,200]},
      {"name":"AI Scoring","type":"n8n-nodes-base.httpRequest","position":[850,200]},
      {"name":"Send to CRM","type":"n8n-nodes-base.httpRequest","position":[1050,200]},
      {"name":"Send Notification","type":"n8n-nodes-base.slack","position":[1050,400]},
      {"name":"Error Handler","type":"n8n-nodes-base.stopAndError","position":[650,450]}
    ],
    "connections":{
      "Webhook":{"main":[[{"node":"Validate Data","type":"main","index":0}]]},
      "Validate Data":{"main":[[{"node":"Enrich Lead","type":"main","index":0}],[{"node":"Error Handler","type":"main","index":0}]]},
      "Enrich Lead":{"main":[[{"node":"AI Scoring","type":"main","index":0}]]},
      "AI Scoring":{"main":[[{"node":"Send to CRM","type":"main","index":0},{"node":"Send Notification","type":"main","index":0}]]}
    }
  };
  document.getElementById('jsonInput').value=JSON.stringify(sample,null,2);
  visualize();
}

function exportPNG(){
  const svg=document.getElementById('svg');
  if(!svg.innerHTML||svg.childNodes.length<=1){toast('Nothing to export');return}
  const svgData=new XMLSerializer().serializeToString(svg);
  const canvas=document.createElement('canvas');
  const vb=(svg.getAttribute('viewBox')||'0 0 800 600').split(' ').map(Number);
  canvas.width=vb[2]*2;canvas.height=vb[3]*2;
  const ctx=canvas.getContext('2d');
  ctx.scale(2,2);ctx.fillStyle='#0a0a0a';ctx.fillRect(0,0,vb[2],vb[3]);
  const img=new Image();
  img.onload=()=>{
    ctx.drawImage(img,0,0,vb[2],vb[3]);
    const link=document.createElement('a');
    link.download='workflow-diagram.png';
    link.href=canvas.toDataURL('image/png');
    link.click();
    toast('‚úÖ PNG exported');
  };
  img.onerror=()=>toast('‚ùå Export failed');
  img.src='data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svgData);
}

function clearAll(){
  document.getElementById('jsonInput').value='';
  document.getElementById('svg').innerHTML='';
  document.getElementById('emptyState').style.display='';
  ['sNodes','sConns','sTriggers','sErrors'].forEach(id=>document.getElementById(id).textContent='‚Äî');
}

function toast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}

// Auto-visualize on paste
document.getElementById('jsonInput').addEventListener('paste',()=>setTimeout(visualize,100));
</script>
</body>
</html>
